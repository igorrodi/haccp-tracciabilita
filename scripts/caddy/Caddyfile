{
    admin off
    local_certs
    auto_https disable_redirects
}

https://haccp.local {
    tls internal

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        -Server
    }

    # PocketBase API - proxy directly (SDK adds /api automatically)
    handle /api/* {
        reverse_proxy 127.0.0.1:8090 {
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }

    # PocketBase Admin UI
    handle /_/* {
        reverse_proxy 127.0.0.1:8090
    }

    # Frontend SPA
    handle {
        root * /opt/haccp/frontend
        encode gzip
        try_files {path} /index.html
        file_server
    }

    @static path *.js *.css *.png *.jpg *.ico *.svg *.woff2
    header @static Cache-Control "public, max-age=31536000, immutable"
}

http://haccp.local {
    redir https://{host}{uri} permanent
}
